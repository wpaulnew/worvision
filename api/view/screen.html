<!DOCTYPE html>
<html id="iframe-view-container-screen">
<head>
  <meta charset="UTF-8">
  <title>Screen</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700,800,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./screen.css">
</head>
<body class="noselect">

<div class="view">

  <div id="bible-container">
    <p id="bible-reference"></p>
    <p id="bible-text"></p>
  </div>

  <div id="track">
    <p id="track-text"></p>
  </div>

</div>

<script>

  // Get initial props from db
  fetch(`http://${location.host}/current`, {mode: 'cors'})
    .then((reply) => reply.json())
    .then(
      (reply) => {

        const response = JSON.parse(reply.data);

        const divBible = document.getElementById('bible-container');
        const divTrack = document.getElementById('track');

        if (response.category === 'bible') {
          divTrack.style.display = "none";
          divBible.style.display = "flex";

          document.getElementById('bible-reference').innerText = response.data.book + ' ' + response.data.chapter + ':' + response.data.id;
          document.getElementById('bible-text').innerHTML = response.data.text;
        }

        if (response.category === 'tracks') {
          divBible.style.display = "none";
          divTrack.style.display = "flex";

          document.getElementById('track-text').innerText = response.data.text;
        }
      }
    );

  // Check for page open in frame or not
  function inIframe () {
    try {
      return window.self !== window.top;
    } catch (e) {
      return true;
    }
  }

  console.log(inIframe() ? 'Page open if frame': 'Page not open in frame');
  if (inIframe()) {
    document.getElementById('iframe-view-container-screen').style.zoom = '40%';
    document.getElementById('iframe-view-container-screen').style.height = '100%';
    document.getElementById('iframe-view-container-screen').style.display = 'flex';
    document.getElementById('iframe-view-container-screen').style.justifyContent = 'center';

    document.body.style.height = '100%';
    document.body.style.boxSizing = 'border-box';
    document.getElementById('bible-text').style.fontSize = '2em';
  }

  const ws = new WebSocket(`ws://192.168.0.100:3001/`);
  console.log(ws);
  ws.onmessage = function (event) {
    // console.log(event.data);
    const response = JSON.parse(event.data);

    const divBible = document.getElementById('bible-container');
    const divTrack = document.getElementById('track');

    if (response.type === 'bible') {
      divTrack.style.display = "none";
      divBible.style.display = "flex";

      document.getElementById('bible-reference').innerText = response.data.book + ' ' + response.data.chapter + ':' + response.data.id;
      document.getElementById('bible-text').innerHTML = response.data.text;
    }

    if (response.type === 'tracks') {
      divBible.style.display = "none";
      divTrack.style.display = "flex";

      document.getElementById('track-text').innerText = response.data.text;
    }
  };

</script>

</body>
</html>
